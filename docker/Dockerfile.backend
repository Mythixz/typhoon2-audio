# Lightweight TTS/STT backend for testing
FROM python:3.10-slim

ENV DEBIAN_FRONTEND=noninteractive

# System dependencies
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
      git curl ca-certificates \
      # Audio processing dependencies
      ffmpeg libsndfile1-dev && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Upgrade pip
RUN python3 -m pip install --upgrade pip==24.0

# Install lightweight TTS/STT dependencies
RUN pip3 install \
    fastapi==0.111.0 \
    uvicorn==0.30.1 \
    pydantic==2.8.2 \
    python-multipart==0.0.9 \
    numpy==2.1.1 \
    soundfile==0.12.1 \
    librosa==0.10.1 \
    gTTS==2.5.1 \
    SpeechRecognition==3.10.0 \
    pyttsx3==2.90 \
    openai-whisper==20231117 \
    requests==2.31.0 \
    python-dotenv==1.0.0

# Copy project files
COPY . /app

# Set environment variables
ENV PYTHONPATH=/app
ENV DEFAULT_TTS_LANGUAGE=en
ENV DEFAULT_STT_LANGUAGE=en
ENV WHISPER_MODEL_SIZE=tiny
ENV DEBUG_MODE=true

EXPOSE 8000

# Run the lightweight TTS/STT API
CMD ["uvicorn", "backend.app.main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"] 